#pragma config(Hubs,  S1, HTMotor,  HTMotor,  none,     none)
#pragma config(Sensor, S1,     ,               sensorI2CMuxController)
#pragma config(Sensor, S2,     SMUX,           sensorNone)
#pragma config(Sensor, S3,     sGyro,          sensorNone)
#pragma config(Sensor, S4,     sLiftStop,      sensorNone)
#pragma config(Motor,  motorA,          mFlagRaise1,   tmotorNXT, openLoop)
#pragma config(Motor,  motorB,          mFlagRaise2,   tmotorNXT, openLoop)
#pragma config(Motor,  motorC,          mBlockStop,    tmotorNXT, openLoop)
#pragma config(Motor,  mtr_S1_C1_1,     mDriveLeft,    tmotorTetrix, openLoop, encoder)
#pragma config(Motor,  mtr_S1_C1_2,     mDriveRight,   tmotorTetrix, openLoop, reversed, encoder)
#pragma config(Motor,  mtr_S1_C2_1,     mBrush,        tmotorTetrix, openLoop)
#pragma config(Motor,  mtr_S1_C2_2,     mLift,         tmotorTetrix, openLoop)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

// Include a file to handle messages from the joystick
#include "JoystickDriver.c"


short stickValueLeftForward;
short stickValueRightForward;
short stickValueLeftBackward;
short stickValueRightBackward;

bool buttonStraightDrive;
bool buttonBackwardsDrive;
bool buttonBrush;
bool buttonLiftUp;
bool buttonLiftDown;

/*
*	getCustomJoystickSettings
*	Translate the joystick values to reusable variables
*/
void getCustomJoystickSettings ()
{
	stickValueRightForward = joystick.joy1_y2;			// Driver 1 right stick
	stickValueLeftForward = joystick.joy1_y1;			// Driver 1 left stick
	stickValueRightBackward = -1 * joystick.joy1_y1;	// Driver 1 left stick
	stickValueLeftBackward = -1 * joystick.joy1_y2;		// Driver 1 right stick

	buttonStraightDrive = (joy1Btn(3) == 1);			// Driver 1 red button
	buttonBackwardsDrive = (joy1Btn(5) == 1);			// Driver 1 left shoulder
	buttonBrush = (joy1Btn(6) == 1);					// Driver 1 rigth shoulder
	buttonLiftUp = (joy2Btn(6) == 1);					// Driver 2 right shoulder
	buttonLiftDown = (joy2Btn(8) == 1);					// Driver 2 right trigger

}

/*
*	printInfoToScreen
*	Print information to the NXT screen
*/
void printInfoToScreen()
{

		nxtDisplayTextLine(1, "LeftDr:%d", motor[mDriveLeft]);		// Left drive motor settings
		nxtDisplayTextLine(2, "RightDr:%d", motor[mDriveRight]);	// Right drive motor settings
		nxtDisplayTextLine(3, "LeftSt:%d", stickValueLeftForward);	// Left joystick
		nxtDisplayTextLine(4, "RightSt:%d", stickValueRightForward);	// Right joystick
		nxtDisplayTextLine(5, "RB:%d", stickValueRightBackward);
		nxtDisplayTextLine(6, "LB:%d", stickValueLeftBackward);
}


/*
* 	stickToMotorValue
* 	Convert the -127 - 128 stick value to a -100 - 100 motor value
*/
short stickToMotorValue(short stickValue)
{
	return (short) ( (float)stickValue * 0.78125);
}

/*
*	initializeRobot
*	Sets the robot's motors and servos to their starting values. Also
*	prepares sensors and multiplexers, as well as the NXT.
*/
void initializeRobot()
{

}

task main()
{
	// Sets robot to starting positions
	initializeRobot();

	// Clear the display
	bDisplayDiagnostics = false;
	eraseDisplay();

	// Play a ready sound
	PlaySound(soundFastUpwardTones);

	// Print a teleop ready message
	nxtDisplayBigTextLine(1, "TELEOP");
	nxtDisplayBigTextLine(3, "READY");

	// Wait for the start of the match
	waitForStart();

	// Print a teleop running message
	nxtDisplayBigTextLine(3, "RUNNING");

	// Play a starting sound
	PlaySound(soundUpwardTones);



	// Loop forever
	while(true)
	{
		// Updates joystick settings
		getJoystickSettings(joystick);

		getCustomJoystickSettings ();

		// STRAIGHT DRIVE
		// If button 3 on joystick 1 is pressed
		if(buttonStraightDrive)
		{
			// Move both motors together based on left joystick position
			motor[mDriveLeft] = (abs(stickValueLeftForward) > 15)? stickToMotorValue(stickValueLeftForward) : 0;
			motor[mDriveRight] = (abs(stickValueLeftForward) > 15)? stickToMotorValue(stickValueLeftForward) : 0;
		}
		// BACKWARDS DRIVE
		// If button 5 is pressed
		else if(buttonBackwardsDrive)
		{
			motor[mDriveLeft] = (abs(stickValueLeftBackward) > 15)? stickToMotorValue(stickValueLeftBackward) : 0;
			motor[mDriveRight] = (abs(stickValueRightBackward) > 15)? stickToMotorValue(stickValueRightBackward) : 0;
		}
		// NORMAL DRIVE
		// If button 3 on joystick 1 is not pressed
		else
		{
			// Move the motors independently, based on their respective joystick positions
			motor[mDriveLeft] = (abs(stickValueLeftForward) > 15)? stickToMotorValue(stickValueLeftForward) : 0;
			motor[mDriveRight] = (abs(stickValueRightForward) > 15)? stickToMotorValue(stickValueRightForward) : 0;
		}

		// BRUSH
		// If button 6 on joystick 1 is pressed, set the brush motor to full power.
		// If it is not pressed, set the brush motor to 0.
		motor[mBrush] = (buttonBrush)? 100 : 0;

		// LIFT
		// If button 6 on joystick 2 is pressed, set the lift motor to full speed up
		// If button 8 on joystick 2 is pressed, set the lift motor to full speed down
		// If neither are pressed, set the lift motor to 0
		motor[mLift] = (buttonLiftUp) ? 100 : ((buttonLiftDown) ? -100 : 0);

	}
}
